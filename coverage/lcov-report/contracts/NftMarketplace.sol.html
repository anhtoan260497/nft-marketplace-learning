<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/NftMarketplace.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> NftMarketplace.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/34</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.7;
&nbsp;
import "@openzeppelin/contracts/interfaces/IERC721.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
&nbsp;
error NftMarketplace__InsufficentPrice();
error NftMarketplace__NotApproved();
error NftMarketplace__AlreadyListed(address nftAddress, uint256 tokenId);
error NftMarketplace__NotNftOwnerForListing();
error NftMarketplace__NotListed(address nftAddress, uint256 tokenId);
error NftMarketplace__NotEnoughBalanceToBuy(address nftAddress, uint256 tokenId, uint256 price);
error NftMarketplace__NotHasProceedToWidthdraw();
error NftMarketplace__TransferFailed();
&nbsp;
contract NftMarketplace is ReentrancyGuard {
    struct Listing {
        uint256 price;
        address seller;
    }
&nbsp;
    event ItemList(
        address indexed seller,
        address indexed nftAddress,
        uint256 indexed tokenId,
        uint256 price
    );
&nbsp;
    event ItemBought(
        address indexed buyer,
        address indexed NftAddress,
        uint256 indexed tokenId,
        uint256 price
    );
&nbsp;
    event ItemUpdate (
        address indexed nftAddress,
        uint256 indexed tokenId,
        address indexed seller,
        uint256 newPrice
    );
&nbsp;
    event ItemCancel(address indexed nftAddress, uint256 indexed tokenId, address indexed seller);
&nbsp;
    mapping(address =&gt; mapping(uint256 =&gt; Listing)) private s_listing; // s_listing : {address : { tokenid : { price, seller }}}
    mapping(address =&gt; uint256) private s_proceeds;
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier NotListed(</span>
        address nftAddress,
        uint256 tokenId,
        address owner
    ) {
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listing[nftAddress][tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (listing.price != 0) revert NftMarketplace__AlreadyListed(nftAddress, tokenId);</span>
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isNftOwner(</span>
        address nftAddress,
        uint256 tokenId,
        address spender
    ) {
<span class="cstat-no" title="statement not covered" >        IERC721 nft = IERC721(nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        address owner = nft.ownerOf(tokenId);</span>
<span class="cstat-no" title="statement not covered" >        if (owner != spender) revert NftMarketplace__NotNftOwnerForListing();</span>
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isListed(address nftAddress, uint256 tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listing[nftAddress][tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (listing.price &lt;= 0) revert NftMarketplace__NotListed(nftAddress, tokenId);</span>
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function listItem(</span>
        address nftAddress,
        uint256 tokenId,
        uint256 price
    )
        external
        NotListed(nftAddress, tokenId, msg.sender)
        isNftOwner(nftAddress, tokenId, msg.sender)
    {
<span class="cstat-no" title="statement not covered" >        if (price &lt;= 0) revert NftMarketplace__InsufficentPrice();</span>
<span class="cstat-no" title="statement not covered" >        IERC721 nft = IERC721(nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        if (nft.getApproved(tokenId) != address(this)) revert NftMarketplace__NotApproved();</span>
        s_listing[nftAddress][tokenId] = Listing(price, msg.sender);
<span class="cstat-no" title="statement not covered" >        emit ItemList(msg.sender, nftAddress, tokenId, price);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function buyItem(</span>
        address nftAddress,
        uint256 tokenId
    ) external payable isListed(nftAddress, tokenId) nonReentrant {
<span class="cstat-no" title="statement not covered" >        Listing memory listedItem = s_listing[nftAddress][tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (msg.value &gt; listedItem.price)</span>
            revert NftMarketplace__NotEnoughBalanceToBuy(nftAddress, tokenId, msg.value);
&nbsp;
        s_proceeds[listedItem.seller]  += msg.value;
        delete (s_listing[nftAddress][tokenId]);
<span class="cstat-no" title="statement not covered" >        IERC721 nft = IERC721(nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        nft.safeTransferFrom(listedItem.seller, msg.sender, tokenId)</span>;
<span class="cstat-no" title="statement not covered" >        emit ItemBought(msg.sender, nftAddress, tokenId, listedItem.price);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function cancelListing(</span>
        address nftAddress,
        uint256 tokenId
    ) external isListed(nftAddress, tokenId) isNftOwner(nftAddress, tokenId, msg.sender) {
        delete s_listing[nftAddress][tokenId];
<span class="cstat-no" title="statement not covered" >        emit ItemCancel(nftAddress, tokenId, msg.sender);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function updateListing(</span>
        address nftAddress,
        uint256 tokenId,
        uint256 newPrice
    ) external isListed(nftAddress, tokenId) isNftOwner(nftAddress, tokenId, msg.sender) {
        s_listing[nftAddress][tokenId].price = newPrice;
<span class="cstat-no" title="statement not covered" >        emit ItemUpdate(nftAddress, tokenId, msg.sender, newPrice) ;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function widthdrawProceeeds () external nonReentrant{</span>
<span class="cstat-no" title="statement not covered" >        uint256 proceeds = s_proceeds[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        if(proceeds &lt;= 0 ) revert NftMarketplace__NotHasProceedToWidthdraw();</span>
        s_proceeds[msg.sender] = 0;
<span class="cstat-no" title="statement not covered" >        (bool success,) = payable(msg.sender).call{value : proceeds}("");</span>
<span class="cstat-no" title="statement not covered" >        if(!success) revert NftMarketplace__TransferFailed();</span>
    }
&nbsp;
    // Getter Functions
&nbsp;
<span class="fstat-no" title="function not covered" >    function getListing(address nftAddress, uint256 tokenId) external view returns(Listing memory) {</span>
<span class="cstat-no" title="statement not covered" >        return s_listing[nftAddress][tokenId];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getProceeds(address seller) external view returns(uint256){</span>
<span class="cstat-no" title="statement not covered" >        return s_proceeds[seller];</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Mar 21 2024 15:26:43 GMT+0700 (Indochina Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
